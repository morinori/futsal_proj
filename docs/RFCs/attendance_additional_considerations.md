# Attendance Feature – Additional Considerations

출석 정원/대기열 기능을 구현할 때 놓치기 쉬운 운영·보안·문서 항목을 정리한다. Claude Code는 이 문서를 확인해 개발 범위를 확정하고 후속 작업을 계획해야 한다.

## 1. 보안 & 가드레일
- `docs/vuln.md` 규칙(직렬화, SQL 파라미터 바인딩)을 준수하고, 대기열/정원 관련 메시지 출력 시 HTML 주입을 방지한다.
- 출석 정원 변경, 대기열 승급 등 중요한 이벤트는 관리자 세션에서만 허용되며, URL 파라미터 기반 복원 금지 정책을 다시 검토한다.
- 오버라이드나 수동 승급 기능을 도입하면 감사 로그 요구 여부를 재확인하고, 필요 시 별도 RFC(Retention 정책 포함)를 작성한다.

## 2. 데이터 백업 & 롤백
- `matches`, `attendance` 스키마 변경이 포함되므로 배포 전 DB 백업 경로와 롤백 절차를 명시한다.
- `docs/vuln.md`/`claude_guardrails.md`의 운영 스크립트(`purge_videos.sh` 등) 지침을 다시 확인하고, 정원/대기열 데이터가 손실되지 않도록 주기적 스냅샷 계획을 세운다.

## 3. 테스트 & 품질
- `pytest` 단위 테스트에 정원 내/정원 초과/대기자 승급/관리자 오버라이드 케이스를 추가한다.
- `docs/TEST_PLAN.md`에 시나리오 기반 수동 테스트(정원 수정, 대기자 알림, 마감 후 동작 등)를 기록해 QA 누락을 방지한다.
- 출석 페이지 렌더링 시 참석자 수 계산이 과도하게 반복되지 않도록 레포지토리 쿼리를 점검하고 인덱스를 추가한다.

## 4. 문서 및 커뮤니케이션
- 기능 배포 시 `docs/SPEC.md`, `docs/ROADMAP.md`, `docs/CHANGELOG.md`에 반영하여 다른 협업자에게 최신 상태를 공유한다.
- 운영팀과 정원 정책(최대 인원, 대기자 우선순위, 알림 채널)을 합의하고, 필요 시 `docs/QUESTIONS.md`에 의존성/오픈 이슈를 업데이트한다.

## 5. 운영 플로우
- 정원 변경이나 대기열 승급 시 사용자 알림(세션 메시지, 이메일/Slack 등) 전략을 결정한다.
- 마감 시간이 지난 뒤의 대기열 처리 정책(자동 승급 vs. 관리자 승인)을 정의하고 UI에 명확히 표시한다.
- 성능/사용성 관점에서 대기열 요청이 많을 때 Streamlit 세션이 끊기지 않도록 debounce 또는 API 경량화 방안을 고려한다.

## 6. 후속 액션
1. 감사 로그/대기열 정책이 확정되면 별도 RFC 작성.
2. 운영팀과 알림 채널 및 커뮤니케이션 방식을 문서화.
3. DB 백업/롤백 체크리스트를 `docs/vuln.md` 또는 운영 매뉴얼에 추가.
